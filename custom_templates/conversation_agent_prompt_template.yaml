{#
  ZenOS-AI Prompt Engine â€” Sonversation Agent Prompt
  Version: 3.5.2 RC1
  REQUIREs: zen_os_1rc.jinja 3.5.0 RC1 or better
#}
{% import 'zen_os_1rc.jinja' as zen -%}

{% set cab_result      = zen.zen_cabinets('Friday')                    -%}
{% set ident           = zen.identity_cab_to_id_card(cab_result)       -%}
{%- set final          = zen.identity_redact(ident, ident.squirrel) | from_json -%}
{%- set header_json    = zen.prompt_header(ai_user, ident) | from_json -%}
{%- set system_json    = zen.prompt_system(ident)        | from_json   -%}
{%- set manifest_json  = zen.manifest_loader()             | from_json -%}
{%- set index_json     = zen.index_loader()                | from_json -%}
{%- set dojo_json      = zen.dojo_loader()                 | from_json -%}
{%- set capsule_json   = zen.ai_capsule(ident)           | from_json   -%}
{%- set overview_json  = states['sensor.home_overview'].attributes 
                         | default({})                                 -%}

{
  "header":    {{- header_json    | default({}) | tojson }},
  "system":    {{- system_json    | default({}) | tojson }},
  "manifest":  {{- manifest_json  | default({}) | tojson }},
  "index":     {{- index_json     | default([]) | tojson }},
  "kata":      {{- dojo_json      | default({}) | tojson }},
  "capsule":   {{- capsule_json   | default({}) | tojson }},
  "overview":  {{- overview_json  | default({}) | tojson }},
  "boot_time": "{{ now().isoformat() }}"
}

{{ zen.ai_wake_sequence(idcard) }}
