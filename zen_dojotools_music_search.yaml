sequence:
  - action: music_assistant.search
    data:
      config_entry_id: 01JFR5BN8CTH8FWXG9GWKC2QG8
      name: "{{ query }}"
      artist: "{{ artist | default('') }}"
      album: "{{ album | default('') }}"
      limit: "{{ number | default(25) }}"
      library_only: "{{ status | default( 'true') }}"
      media_type: "{{ media_type | default(None) }}"
    response_variable: action_response
  - stop: Return data through response variable
    response_variable: action_response
    enabled: true
  - set_conversation_response: |-
      response:
        'music_assistant': {
          'search': '{{ query | default('')}}',
          'artist': '{{ artist | default('') }}',
          'album': '{{ album | default('') }}',
          'media_type': '{{ media_type | default('') }}',
          'number': {{ number| default(25) }},
          'status': {{ status | default(true) }},
          'result':
            {%- if action_response | count | int(0) > 0 -%}
            {%- for library in action_response %}
            '{{library}}': {
              {%- if action_response[library] | count | int(0) > 0 -%}
              {%- for media in action_response[library] %}
              {{ media }},
              {%- endfor %}
              {%- else %}
              {%- endif %}
            },
            {%- endfor %}
            {%- else %}
            {%- endif %}
          }
fields:
  query:
    selector:
      text: null
    description: The query term to look for
    name: Search query
    required: true
    default: null
  number:
    selector:
      number:
        min: 1
        max: 50
    name: Number Per Page
    description: >-
      The number of responses to return, max 50 defaults defaults 5 if nothing
      is provided
    default: 5
  status:
    selector:
      boolean: {}
    name: Restrict Search to Music Assistant Library?
    description: >-
      Restrict search to Library; True, only search the library (default);
      False, ...and the internet - may get wild stuff.
    required: false
    default: true
  artist:
    selector:
      text: null
    name: Artist
    description: Optional - Filter Search by Artist
  album:
    selector:
      text: null
    name: Album
    description: Optional - Filter Search by Album
  media_type:
    selector:
      select:
        multiple: true
        options:
          - artist
          - album
          - track
          - playlist
          - radio
          - audiobook
          - podcast
    name: Media Type
    description: >-
      Optional filter search to any of: artist, album, track, playlist, radi0,
      audiobook, podcast
alias: Zen Dojotools Music Search
description: |-
  Zen Dojotools Music Search (helper for Music Assistant)
  Search for music and other audio in the Music Assistant Database
  Returns media names and uri for term: 'query'
  Defaults to 5 items, modify number of responses by specifying 'number'
icon: mdi:music
