alias: Zen DojoTools Event Emitter
description: >
  Zen DojoTools Event Emitter (v1.1.2)

  Emits a structured ZenOS-AI event onto the Home Assistant EventBus. Events are
  used for observability, debugging, trace reconstruction, and leaving state
  breadcrumbs for Friday, Kronk, or Monastery processes.

  Event Shape:
    event: {
      timestamp: ISO-8601 string,
      component: string (required),
      severity: "debug" | "info" | "warn" | "error",
      kind: short classifier string (required),
      summary: human-readable description (required),
      metadata: object (optional, small),
      kata: object (optional),
      monk: object (optional)
    }

  HA emits this under:
    event_type: "zen_event"
    event_data:
      event: { ...payload above... }

  LLM Instructions:
    - Payloads MUST be small (KB-scale only).
    - Do NOT include raw logs, file contents, full device states, or long arrays.
    - Use for breadcrumbs (“Friday performed X”), insights, micro-summaries.
    - Do not emit in tight loops; only meaningful events.
    - Never attempt writes, system changes, or privileged actions.

  Safe by design: the tool only posts an event and does not alter HA state.
fields:
  component:
    selector:
      text: {}
    required: true
    description: >
      REQUIRED. Name of the subsystem generating this event. Examples: "friday",
      "monastery", "log_viewer", "filecabinet", "room_manager", "warden".
  severity:
    selector:
      select:
        options:
          - debug
          - info
          - warn
          - error
    default: info
    description: >
      Impact level. debug=internal chatter, info=normal ops, warn=unexpected but
      safe, error=problem or failure.
  kind:
    selector:
      text: {}
    required: true
    description: >
      REQUIRED. Short classifier for the event. Examples: "tail", "fetch",
      "summary", "kata_emit", "heartbeat".
  summary:
    selector:
      text: {}
    required: true
    description: >
      REQUIRED. Brief human-readable description (1–2 sentences max). Used for
      breadcrumbs, timelines, and debugging traces.
  metadata:
    selector:
      object: {}
    default: {}
    description: >
      OPTIONAL. Small structured key/value details relevant to this event. Do
      NOT include logs, long strings, or large arrays.
  kata:
    selector:
      object: {}
    default: {}
    description: |
      OPTIONAL. Tiny kata snapshot summarizing relevant state. High-level only.
  monk:
    selector:
      object: {}
    default: {}
    description: |
      OPTIONAL. Miniature monk reasoning breadcrumb. Not full reasoning.
mode: parallel
sequence:
  - variables:
      ts: "{{ now().isoformat() }}"
      evt:
        timestamp: "{{ ts }}"
        component: "{{ component }}"
        severity: "{{ severity }}"
        kind: "{{ kind }}"
        summary: "{{ summary }}"
        metadata: "{{ metadata | default({}) }}"
        kata: "{{ kata | default({}) }}"
        monk: "{{ monk | default({}) }}"
  - event: zen_event
    event_data:
      event: "{{ evt }}"
  - data:
      message: >
        zen_event {{ evt.component }} | {{ evt.kind }} | {{ evt.severity }} |
        summary="{{ evt.summary }}" | meta={{ evt.metadata | to_json }}
      level: "{{ severity }}"
    action: system_log.write
  - variables:
      final:
        status: success
        message: Zen event emitted
        event: "{{ evt }}"
  - stop: done
    response_variable: final
